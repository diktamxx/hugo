---
title: "浅谈事务理解"
slug: "transactions"
categories: ["数据库"]
tags: ["数据库","SQL","NoSQL"]
date: "2025-02-08"
cover: "images/cover.png"
thumbnail: "images/cover.png"
summary: "开发不是搞概念，但搞清楚概念能让你更好地胜任工作。"
---

| 用语 <div style="width:8em"> | 解释 |
| ----------- | ----------- |
| 查询 | 泛指针对数据记录而执行的操作（，而非特指*select*）。|
| 逻辑单元 | 在功能或语义上紧密相关、共同完成某个特定任务的一组代指令。|
| 领域 | 人类知识和活动的逻辑边界。|
| 事务 | 所做的或要做的事情。|
| 业务 | 为特定群体创造价值而展开的活动。这些活动会受到所在行业（和企业）的*规则*和*流程*所约束。|
| 业务领域 | 强调业务的范畴。|
| 用例 | 系统响应外部请求的潜在场景。定义角色与系统之间的交互步骤，和明确操作目的。|
| 原子性 | 不可分割的整体。在软件开发中，通常用来表达一种“要么同时成功，否则就应该同时失败”的语义。 |
| 准确性 | 数据处理结果与事实的吻合程度。|
| 一致性 | 该词在不同的上下文中会有不同解释。此处可理解为<u>确保数据的约束规则不会遭到破坏</u>（如：主键、外键、唯一性等）。 |
| 数据完整性 | 在数据的生命周期内确保其*一致性*和*准确性*（即数据处理结果应该符合规则和预期）。|
| 正确性 | 对数据执行一系列操作后，仍然满足预期定义和逻辑（。该概念涵盖了数据完整性）。|
| 最终一致（性） | 无法马上确保*数据完整性*，但承诺最终会做到这一点（只是时间上存在延迟）。 |

在谈论事务之前，务必先搞清楚事务到底是一个什么概念。或者说，应该从什么角度来理解它才更为妥当。
譬如*技术人员*谈论事务时，通常谈论的是**数据库事务**。此时可将事务理解为是<u>数据库查询的逻辑单元。它由一到多个查询组成，是一个不可分割的整体</u>。
而对于*业务人员*而言，他们谈论的其实是**业务领域事务**。此时事务代表着<u>一个完整的业务范畴</u>。例如对于电商行业而言，顾客的购物过程就属于一个事务。它涵盖了*选择商品*、*加入购物车*、*下单*、*支付*、*商家发货*、*签收*、*评价*等流程。

对于系统设计而言，事务其实是一种保证系统正确性的机制。作为设计者，我们应该关心的是**应用事务**。*应用事务*通常以系统用例为逻辑边界；它真正<u>关心的是*请求处理过程的原子性*</u>。
如果进程能够独自完成事务，那么可将其称为**本地事务**，否则就属于**分布式事务**。前者通常可以直接透过*数据库事务*来实现，而后者则需要依赖特定的*原子提交协议[^1]*或*设计模式*才能解决。

重点注意。缺乏经验的设计者经常存在一个误区，认为系统必须实现*应用事务*才能确保*正确性*。
然而并非如此。**是否需要（应用）事务，其实完全取决于用例本身的严谨程度**。
通常情况下，只有涉及到*金钱*、*健康*、*安全*、*决策*等问题时，系统才会对*正确性*要求苛刻。而在<u>正确性要求不高</u>的用例中<span style="color:gray;">（如 *社交网络*、*内容系统*、*数据分析*）</span>，*事务机制*就不是必须的。因为即便处理过程发生意外，但最终也会因为**重新计算**而达到最终一致。


[^1]: [Atomic commit](https://en.wikipedia.org/wiki/Atomic_commit)